(function(c){function C(p,t){function g(a,f){a.preventDefault();var d=c(a.target).offset();clearTimeout(v);v=!1;if("undefined"!==typeof a.targetTouches){var m=Math.floor(a.targetTouches[0].pageX-d.left);d=Math.floor(a.targetTouches[0].pageY-d.top)}else m=Math.floor(a.pageX-d.left),d=Math.floor(a.pageY-d.top);if(k.x===m&&k.y===d)return!0;null===k.x&&(k.x=m);null===k.y&&(k.y=d);f&&(d+=f);e.beginPath();e.moveTo(k.x,k.y);e.lineTo(m,d);e.lineCap=b.penCap;e.stroke();e.closePath();n.push({lx:m,ly:d,mx:k.x,
my:k.y});k.x=m;k.y=d;b.onDraw&&"function"===typeof b.onDraw&&b.onDraw.apply(w)}function C(){var a=c(b.output,d).val();if(""!==a&&void 0!==a&&(a=JSON.parse(a),!(1>a.length))){for(var f=0,N=a.length;f<N;f++)e.beginPath(),e.moveTo(a[f].mx,a[f].my),e.lineTo(a[f].lx,a[f].ly),e.lineCap=b.penCap,e.stroke(),e.closePath();n=a}}function q(){r()}function r(a){a?g(a,1):(A?l.each(function(){this.removeEventListener("touchmove",g)}):l.unbind("mousemove.signaturepad"),0<n.length&&b.onDrawEnd&&"function"===typeof b.onDrawEnd&&
b.onDrawEnd.apply(w));k.x=null;k.y=null;b.output&&0<n.length&&c(b.output,d).val(JSON.stringify(n))}function u(){G();c(b.output,d).val("");n=[];r()}function G(){e.clearRect(0,0,h.width,h.height);e.fillStyle=b.bgColour;e.fillRect(0,0,h.width,h.height);b.displayOnly||b.lineWidth&&(e.beginPath(),e.lineWidth=b.lineWidth,e.strokeStyle=b.lineColour,e.moveTo(b.lineMargin,b.lineTop),e.lineTo(h.width-b.lineMargin,b.lineTop),e.stroke(),e.closePath());e.lineWidth=b.penWidth;e.strokeStyle=b.penColour}function H(a,
b){null==k.x?g(a,1):g(a,b)}function I(a,b){A?b.addEventListener("touchmove",H,!1):l.bind("mousemove.signaturepad",H);g(a,1)}function P(){D=!1;l.each(function(){this.removeEventListener&&(this.removeEventListener("touchend",q),this.removeEventListener("touchcancel",q),this.removeEventListener("touchmove",g));this.ontouchstart&&(this.ontouchstart=null)});c(document).unbind("mouseup.signaturepad");l.unbind("mousedown.signaturepad");l.unbind("mousemove.signaturepad");l.unbind("mouseleave.signaturepad");
c(b.clear,d).unbind("click.signaturepad")}function J(a){if(D)return!1;D=!0;c("input").blur();"undefined"!==typeof a.targetTouches&&(A=!0);A?(l.each(function(){this.addEventListener("touchend",q,!1);this.addEventListener("touchcancel",q,!1)}),l.unbind("mousedown.signaturepad")):(c(document).bind("mouseup.signaturepad",function(){y&&(r(),clearTimeout(v),y=v=!1)}),l.bind("mouseleave.signaturepad",function(a){y&&r(a);y&&!v&&(v=setTimeout(function(){r();clearTimeout(v);y=v=!1},500))}),l.each(function(){this.ontouchstart=
null}))}function E(){c(b.typed,d).hide();G();l.each(function(){this.ontouchstart=function(a){a.preventDefault();y=!0;J(a);I(a,this)}});l.bind("mousedown.signaturepad",function(a){a.preventDefault();if(1<a.which)return!1;y=!0;J(a);I(a)});c(b.clear,d).bind("click.signaturepad",function(a){a.preventDefault();u()});c(b.typeIt,d).bind("click.signaturepad",function(a){a.preventDefault();K()});c(b.drawIt,d).unbind("click.signaturepad");c(b.drawIt,d).bind("click.signaturepad",function(a){a.preventDefault()});
c(b.typeIt,d).removeClass(b.currentClass);c(b.drawIt,d).addClass(b.currentClass);c(b.sig,d).addClass(b.currentClass);c(b.typeItDesc,d).hide();c(b.drawItDesc,d).show();c(b.clear,d).show()}function K(){u();P();c(b.typed,d).show();c(b.drawIt,d).bind("click.signaturepad",function(a){a.preventDefault();E()});c(b.typeIt,d).unbind("click.signaturepad");c(b.typeIt,d).bind("click.signaturepad",function(a){a.preventDefault()});c(b.output,d).val("");c(b.drawIt,d).removeClass(b.currentClass);c(b.typeIt,d).addClass(b.currentClass);
c(b.sig,d).removeClass(b.currentClass);c(b.drawItDesc,d).hide();c(b.clear,d).hide();c(b.typeItDesc,d).show();x=z=c(b.typed,d).css("font-size").replace(/px/,"")}function L(a){var f=c(b.typed,d);a=c.trim(a.replace(/>/g,"&gt;").replace(/</g,"&lt;"));var e=B,m=.5*x;B=a.length;f.html(a);if(a){if(B>e&&f.outerWidth()>h.width)for(;f.outerWidth()>h.width;)x--,f.css("font-size",x+"px");if(B<e&&f.outerWidth()+m<h.width&&x<z)for(;f.outerWidth()+m<h.width&&x<z;)x++,f.css("font-size",x+"px")}else f.css("font-size",
z+"px")}function Q(a,b){c("p."+b.errorClass,a).remove();a.removeClass(b.errorClass);c("input, label",a).removeClass(b.errorClass)}function R(a,b,d){a.nameInvalid&&(b.prepend(['<p class="',d.errorClass,'">',d.errorMessage,"</p>"].join("")),c(d.name,b).focus(),c(d.name,b).addClass(d.errorClass),c("label[for="+c(d.name).attr("id")+"]",b).addClass(d.errorClass));a.drawInvalid&&b.prepend(['<p class="',d.errorClass,'">',d.errorMessageDraw,"</p>"].join(""))}function F(){var a=!0,f={drawInvalid:!1,nameInvalid:!1},
e=[d,b],m=[f,d,b];b.onBeforeValidate&&"function"===typeof b.onBeforeValidate?b.onBeforeValidate.apply(w,e):Q.apply(w,e);b.drawOnly&&1>n.length&&(f.drawInvalid=!0,a=!1);""===c(b.name,d).val()&&(f.nameInvalid=!0,a=!1);b.onFormError&&"function"===typeof b.onFormError?b.onFormError.apply(w,m):R.apply(w,m);return a}function M(a,c,d){for(var e in a)"object"===typeof a[e]&&(c.beginPath(),c.moveTo(a[e].mx,a[e].my),c.lineTo(a[e].lx,a[e].ly),c.lineCap=b.penCap,c.stroke(),c.closePath(),d&&n.push({lx:a[e].lx,
ly:a[e].ly,mx:a[e].mx,my:a[e].my}))}function S(){4.1>parseFloat((/CPU.+OS ([0-9_]{3}).*AppleWebkit.*Mobile/i.exec(navigator.userAgent)||[0,"4_2"])[1].replace("_","."))&&(c.fn.Oldoffset=c.fn.offset,c.fn.offset=function(){var a=c(this).Oldoffset();a.top-=window.scrollY;a.left-=window.scrollX;return a});c(b.typed,d).bind("selectstart.signaturepad",function(a){return c(a.target).is(":input")});l.bind("selectstart.signaturepad",function(a){return c(a.target).is(":input")});!h.getContext&&FlashCanvas&&
FlashCanvas.initElement(h);h.getContext&&(e=h.getContext("2d"),c(b.sig,d).show(),b.displayOnly||(b.drawOnly||(c(b.name,d).bind("keyup.signaturepad",function(){L(c(this).val())}),c(b.name,d).bind("blur.signaturepad",function(){L(c(this).val())}),c(b.drawIt,d).bind("click.signaturepad",function(a){a.preventDefault();E()})),b.drawOnly||"drawIt"===b.defaultAction?(E(),C()):K(),b.validateFields&&(c(p).is("form")?c(p).bind("submit.signaturepad",function(){return F()}):c(p).parents("form").bind("submit.signaturepad",
function(){return F()})),c(b.sigNav,d).css("display","block")))}var w=this,b=c.extend({},c.fn.signaturePad.defaults,t),d=c(p),l=c(b.canvas,d),h=l.get(0),e=null,k={x:null,y:null},n=[],v=!1,y=!1,A=!1,D=!1,z=30,x=z,B=0;c.extend(w,{signaturePad:"{{version}}",init:function(){S()},updateOptions:function(a){c.extend(b,a)},regenerate:function(a){w.clearCanvas();c(b.typed,d).hide();"string"===typeof a&&(a=JSON.parse(a));M(a,e,!0);b.output&&0<c(b.output,d).length&&c(b.output,d).val(JSON.stringify(n))},clearCanvas:function(){u()},
getSignature:function(){return n},getSignatureString:function(){return JSON.stringify(n)},getSignatureImage:function(){var a=document.createElement("canvas");a.style.position="absolute";a.style.top="-999em";a.width=h.width;a.height=h.height;document.body.appendChild(a);!a.getContext&&FlashCanvas&&FlashCanvas.initElement(a);var c=a.getContext("2d");c.fillStyle=b.bgColour;c.fillRect(0,0,h.width,h.height);c.lineWidth=b.penWidth;c.strokeStyle=b.penColour;M(n,c);c=a.toDataURL.apply(a,arguments);document.body.removeChild(a);
return c},validateForm:function(){return F()}})}c.fn.signaturePad=function(p){var t=null;this.each(function(){c.data(this,"plugin-signaturePad")?(t=c.data(this,"plugin-signaturePad"),t.updateOptions(p)):(t=new C(this,p),t.init(),c.data(this,"plugin-signaturePad",t))});return t};c.fn.signaturePad.defaults={defaultAction:"typeIt",displayOnly:!1,drawOnly:!1,canvas:"canvas",sig:".sig",sigNav:".sigNav",bgColour:"#ffffff",penColour:"#145394",penWidth:2,penCap:"round",lineColour:"#ccc",lineWidth:2,lineMargin:5,
lineTop:35,name:".name",typed:".typed",clear:".clearButton",typeIt:".typeIt a",drawIt:".drawIt a",typeItDesc:".typeItDesc",drawItDesc:".drawItDesc",output:".output",currentClass:"current",validateFields:!0,errorClass:"error",errorMessage:"Please enter your name",errorMessageDraw:"Please sign the document",onBeforeValidate:null,onFormError:null,onDraw:null,onDrawEnd:null}})(jQuery);
function frmSignatureJS(){function c(){if("undefined"!=typeof __FRMSIG)for(var c=__FRMSIG,p=0,t=c.length;p<t;p++){var g=c[p],O={name:!1,bgColour:"transparent",penColour:g.text_color,penWidth:1.5,lineColour:g.line_color,lineWidth:g.line_width,lineMargin:g.line_margin,lineTop:g.line_top,defaultAction:g.default_tab,validateFields:!1},q=g.width,r=jQuery(".frm_field_"+g.id+"_container:not(.frm_signature), #frm_field_"+g.id+"_container");if(!(1>r.length)){var u=r.find(".sigPad");u.is(":visible")&&(q=u.width());
0<q<parseInt(g.width)&&(u.attr("style","max-width:"+q+"px !important;"),r.find(".typed input").attr("style","max-width:"+(q-11)+"px !important;"),u.find("canvas").attr("width",q-4),r.find('input[name$="[width]"]').val(q-4));r.addClass("frm_signature");u.signaturePad(O)}}}return{init:function(){jQuery(".sigWrapper .typed").click(function(){jQuery(this).find("input").focus()});c();jQuery(document).on("frmPageChanged",c);jQuery(document).on("frmAfterAddRow",c);jQuery(document).on("frmFormComplete",c)}}}
var frmSignature=frmSignatureJS();jQuery(document).ready(function(){frmSignature.init()});